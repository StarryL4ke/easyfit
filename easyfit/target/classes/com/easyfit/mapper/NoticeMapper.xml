<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.easyfit.mapper.NoticeMapper"><!-- Query 작성시 CDATA 꼭 써주세요. -->
<!-- <![CDATA[ SELECT nno, ntitle, ncontent, tno, ndate FROM notice ]]> -->
	
	
	<sql id="criteria">
		<trim prefix="(" suffix=") AND" prefixOverrides="OR">
			<foreach item="type" collection="typeArr">
			<trim prefix="OR">
				<choose>
					<when test="type == 'T'.toString()"> ntitle LIKE '%'||#{keyword}||'%' </when>
					<when test="type == 'C'.toString()"> ncontent LIKE '%'||#{keyword}||'%' </when>
					<when test="type == 'W'.toString()"> tno LIKE '%'||#{keyword}||'%' </when>
				</choose>
			</trim>
			</foreach>
		</trim>
	</sql>
	
	<!-- 공지사항 목록 보기 
	<select id="list" resultType="com.easyfit.domain.NoticeVO">
		<![CDATA[
		SELECT
		    nno, ntitle, ncontent,tno, ndate
		FROM
		    notice
		]]>
	</select>
	-->
	
	<select id="list" resultType="com.easyfit.domain.NoticeVO">
		<![CDATA[ 
		SELECT 
			nno, ntitle, ncontent, tno, ndate 
		FROM ( 
			SELECT rownum rn, nno, ntitle, ncontent, tno, ndate FROM notice 
		WHERE 
			
		]]>
		
		<include refid="criteria"/>
		<![CDATA[ 
		rownum <= #{pageNum} * #{amount} ) WHERE rn > (#{pageNum} - 1) * #{amount} 
		]]>
	</select>
	
	<!--  총 게시글 수  -->
	<select id="count" resultType="Long"> 
	
	
	SELECT count(*) 
	
	FROM notice 
	
	WHERE
	
	<include refid="criteria"/>
	
	<![CDATA[
	nno > 0 
	
	]]>
	
	</select>
		
	
	
	<!--  공지사항 상세보기  -->
	<select id="get" resultType="com.easyfit.domain.NoticeVO"> 
		<![CDATA[
		SELECT
		    nno, ntitle, ncontent, tno, ndate
		FROM
		    notice
		
		WHERE nno = #{nno} 
		]]>
	</select>
	
	
	
	<!--  공지사항 등록하기  -->
	<insert id="register"> 
		<![CDATA[
		INSERT INTO notice(
			 nno, ntitle, ncontent, tno, ndate) 
		VALUES(
			 notice_seq.NEXTVAL, #{ntitle}, #{ncontent}, #{tno}, sysdate) 
		]]>
	</insert>
	
	
	<!--  공지사항 수정하기  -->
	<update id="modify"> 
		<![CDATA[ 
		UPDATE 
			notice 
		SET 
			ntitle = #{ntitle}, 
			ncontent = #{ncontent},
			ndate = sysdate
			
		WHERE 
			nno = #{nno}	
		]]>
	</update>
	
	<!-- 공지사항 삭제하기 -->
	<delete id="remove" >
		<![CDATA[ 
		DELETE
		FROM 
			notice 
		WHERE 
			nno = #{nno} 
		]]>
	</delete>

	
	
	<!-- 공지사항 
	<insert id="registerSelectKey">
	<selectKey keyProperty="nno" order="BEFORE" resultType="long"> 
		SELECT notice_seq.NEXTVAL FROM dual 
	
	</selectKey>
		<![CDATA[
		INSERT INTO 
			notice(nno, ntitle, ncontent,tno, ndate) 
		VALUES(
			#{nno}, #{ntitle}, #{ncontent}, #{tno}, #{ndate})
		]]>
	</insert>
-->


	
	

	
</mapper>
	
















